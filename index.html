<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Miami Ready ‚Äî 70-Day Glute Transformation</title>
    <meta name="description" content="Track your 70-day glute transformation. Connection before load.">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçë</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --cream: #FAF6F1;
            --cream-dark: #F0EBE3;
            --mocha: #8B7355;
            --burgundy: #722F37;
            --wine: #4A1C24;
            --teal: #2D4A47;
            --teal-light: #4A7C77;
            --slate: #64748b;
            --slate-dark: #334155;
            --white: #ffffff;
            --shadow: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-lg: 0 4px 12px rgba(0,0,0,0.15);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'DM Sans', system-ui, sans-serif; 
            background: linear-gradient(to bottom, var(--cream), var(--white));
            min-height: 100vh;
            color: var(--slate-dark);
            -webkit-font-smoothing: antialiased;
        }
        
        /* Header */
        .header {
            background: var(--burgundy);
            color: white;
            padding: 24px 16px;
        }
        .header-inner { max-width: 800px; margin: 0 auto; }
        .header-brand { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
        .header-brand span { font-size: 1.5rem; }
        .header-brand small { opacity: 0.8; font-size: 0.75rem; letter-spacing: 0.5px; }
        .header h1 { font-size: 1.25rem; font-weight: 700; margin-bottom: 4px; }
        .header p { font-size: 0.875rem; opacity: 0.8; }
        .header-badges { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
        
        /* Badges */
        .badge {
            display: inline-flex; align-items: center; gap: 4px;
            padding: 4px 10px; border-radius: 100px;
            font-size: 0.75rem; font-weight: 500;
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .badge-good { background: rgba(16,185,129,0.1); border-color: rgba(16,185,129,0.3); color: #059669; }
        .badge-warn { background: rgba(245,158,11,0.1); border-color: rgba(245,158,11,0.3); color: #d97706; }
        .badge-neutral { background: var(--cream-dark); border-color: #e2e8f0; color: var(--slate); }
        .badge-burgundy { background: rgba(114,47,55,0.1); border-color: rgba(114,47,55,0.3); color: var(--burgundy); }
        .badge-teal { background: rgba(45,74,71,0.1); border-color: rgba(45,74,71,0.3); color: var(--teal); }
        
        /* Cards */
        .card {
            background: var(--white);
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            box-shadow: var(--shadow);
            padding: 16px;
            margin-bottom: 16px;
        }
        .card-title { font-weight: 600; font-size: 0.875rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        
        /* Quick Stats Card */
        .quick-stats { margin: -16px 16px 16px; max-width: 800px; margin-left: auto; margin-right: auto; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(60px, 1fr)); gap: 8px; }
        .stat-item {
            padding: 8px; border-radius: 12px; text-align: center;
            background: var(--cream);
            transition: all 0.2s;
        }
        .stat-item.done { background: rgba(45,74,71,0.1); }
        .stat-item .icon { font-size: 1.25rem; }
        .stat-item .label { font-size: 0.65rem; color: var(--slate); margin-top: 2px; }
        
        /* Progress Ring */
        .progress-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
        .progress-text .pct { font-size: 1.75rem; font-weight: 700; }
        .progress-text .label { font-size: 0.75rem; color: var(--slate); }
        .progress-ring { position: relative; width: 56px; height: 56px; }
        .progress-ring svg { transform: rotate(-90deg); }
        .progress-ring .bg { fill: none; stroke: #e2e8f0; stroke-width: 6; }
        .progress-ring .fg { fill: none; stroke: var(--burgundy); stroke-width: 6; stroke-linecap: round; transition: stroke-dasharray 0.3s; }
        .progress-ring .text { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: 600; }
        
        /* Tabs */
        .tabs { 
            display: flex; gap: 4px; padding: 4px;
            background: #f1f5f9; border-radius: 12px;
            margin: 0 16px 16px; max-width: 800px;
        }
        @media (min-width: 832px) { .tabs { margin-left: auto; margin-right: auto; } }
        .tab {
            flex: 1; padding: 10px 8px; border: none; background: none;
            font-size: 0.8rem; font-weight: 500; color: var(--slate);
            border-radius: 8px; cursor: pointer; transition: all 0.2s;
            font-family: inherit;
        }
        .tab.active { background: var(--white); color: var(--slate-dark); box-shadow: var(--shadow); }
        
        /* Content */
        .content { padding: 0 16px 100px; max-width: 800px; margin: 0 auto; }
        .view { display: none; }
        .view.active { display: block; }
        
        /* Buttons */
        .btn {
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
            padding: 12px 20px; border-radius: 12px; border: none;
            font-size: 0.875rem; font-weight: 600; cursor: pointer;
            font-family: inherit; transition: all 0.2s; width: 100%;
        }
        .btn-primary { background: var(--burgundy); color: white; }
        .btn-primary:hover { background: var(--wine); }
        .btn-secondary { background: #f1f5f9; color: var(--slate-dark); }
        .btn-secondary:hover { background: #e2e8f0; }
        .btn-teal { background: var(--teal); color: white; }
        
        .quick-btn {
            padding: 6px 12px; border-radius: 8px; border: none;
            background: #f1f5f9; color: var(--slate-dark);
            font-size: 0.75rem; font-weight: 500; cursor: pointer;
            font-family: inherit; transition: all 0.2s;
        }
        .quick-btn:hover { background: #e2e8f0; }
        .quick-btn:active { background: var(--burgundy); color: white; }
        
        /* Info Cards */
        .info-card {
            padding: 12px; border-radius: 12px; margin-bottom: 8px;
        }
        .info-card.amber { background: #fffbeb; border: 1px solid #fcd34d; }
        .info-card.teal { background: rgba(45,74,71,0.08); border: 1px solid rgba(45,74,71,0.2); }
        .info-card.burgundy { background: rgba(114,47,55,0.08); border: 1px solid rgba(114,47,55,0.2); }
        .info-card .title { font-weight: 600; font-size: 0.875rem; margin-bottom: 4px; }
        .info-card .text { font-size: 0.8rem; color: var(--slate-dark); }
        
        /* Exercise List */
        .exercise-list { border: 1px solid #e2e8f0; border-radius: 12px; overflow: hidden; }
        .exercise-item { 
            padding: 10px 12px; font-size: 0.8rem; 
            border-bottom: 1px solid #f1f5f9;
            display: flex; justify-content: space-between; align-items: center;
        }
        .exercise-item:last-child { border-bottom: none; }
        .exercise-item .name { font-weight: 500; }
        .exercise-item .sets { color: var(--slate); font-size: 0.75rem; }
        
        /* Timeline */
        .timeline { max-height: 400px; overflow-y: auto; }
        .timeline-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 10px 12px; border-radius: 12px; margin-bottom: 4px;
            background: var(--white); border: 1px solid #e2e8f0;
            cursor: pointer; transition: all 0.2s;
        }
        .timeline-item:hover { border-color: #cbd5e1; }
        .timeline-item.selected { background: var(--burgundy); color: white; border-color: var(--burgundy); }
        .timeline-item.selected .sub { color: rgba(255,255,255,0.7); }
        .timeline-item .main { font-weight: 600; font-size: 0.875rem; }
        .timeline-item .sub { font-size: 0.75rem; color: var(--slate); margin-left: 8px; }
        .timeline-item .right { display: flex; align-items: center; gap: 6px; }
        .timeline-item .check { color: #10b981; }
        .timeline-item.selected .check { color: #6ee7b7; }
        
        /* Form Elements */
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; font-size: 0.75rem; color: var(--slate); margin-bottom: 6px; font-weight: 500; }
        .form-input {
            width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0;
            border-radius: 10px; font-size: 0.875rem; font-family: inherit;
            transition: all 0.2s;
        }
        .form-input:focus { outline: none; border-color: var(--burgundy); box-shadow: 0 0 0 3px rgba(114,47,55,0.1); }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .form-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
        
        /* Checkbox */
        .checkbox-item {
            display: flex; align-items: center; gap: 12px;
            padding: 12px; border-radius: 12px; cursor: pointer;
            background: var(--white); border: 1px solid #e2e8f0;
            transition: all 0.2s; margin-bottom: 8px;
        }
        .checkbox-item.checked { background: rgba(45,74,71,0.08); border-color: var(--teal); }
        .checkbox-box {
            width: 24px; height: 24px; border-radius: 6px;
            border: 2px solid #cbd5e1; display: flex; align-items: center; justify-content: center;
            font-size: 0.8rem; color: white; transition: all 0.2s; flex-shrink: 0;
        }
        .checkbox-item.checked .checkbox-box { background: var(--teal); border-color: var(--teal); }
        .checkbox-label { font-size: 0.875rem; }
        
        /* Connection Grid */
        .conn-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .conn-btn {
            padding: 10px 4px; border-radius: 12px; border: 1px solid #e2e8f0;
            background: var(--white); cursor: pointer; text-align: center;
            transition: all 0.2s; font-family: inherit;
        }
        .conn-btn:hover { border-color: #cbd5e1; }
        .conn-btn.selected { border-color: var(--burgundy); background: rgba(114,47,55,0.08); }
        .conn-btn .emoji { font-size: 1.5rem; display: block; }
        .conn-btn .label { font-size: 0.65rem; color: var(--slate); margin-top: 2px; }
        
        /* Tempo Grid */
        .tempo-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .tempo-btn {
            padding: 10px; border-radius: 10px; border: 1px solid #e2e8f0;
            background: var(--white); cursor: pointer; text-align: center;
            font-size: 0.8rem; font-weight: 500; transition: all 0.2s;
            font-family: inherit;
        }
        .tempo-btn.selected { border-color: var(--burgundy); background: rgba(114,47,55,0.08); }
        
        /* Modal */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.5);
            display: none; align-items: flex-end; justify-content: center;
            z-index: 1000; padding: 0;
        }
        .modal-overlay.active { display: flex; }
        @media (min-width: 640px) {
            .modal-overlay { align-items: center; padding: 20px; }
            .modal { border-radius: 20px !important; max-height: 85vh; }
        }
        .modal {
            background: var(--white); border-radius: 20px 20px 0 0;
            width: 100%; max-width: 500px; max-height: 90vh;
            overflow-y: auto; position: relative;
        }
        .modal-header {
            position: sticky; top: 0; background: var(--white);
            padding: 16px; border-bottom: 1px solid #e2e8f0;
            display: flex; justify-content: space-between; align-items: center;
            z-index: 10;
        }
        .modal-header h2 { font-size: 1rem; font-weight: 700; }
        .modal-header p { font-size: 0.8rem; color: var(--slate); }
        .modal-close {
            width: 32px; height: 32px; border-radius: 8px; border: none;
            background: #f1f5f9; cursor: pointer; font-size: 1.25rem;
            display: flex; align-items: center; justify-content: center;
        }
        .modal-body { padding: 16px; }
        .modal-footer {
            position: sticky; bottom: 0; background: var(--white);
            padding: 16px; border-top: 1px solid #e2e8f0;
        }
        
        /* Section divider */
        .section-title { font-size: 0.8rem; font-weight: 600; margin: 20px 0 12px; color: var(--slate-dark); }
        
        /* Chart placeholder */
        .chart-container { height: 200px; background: #f8fafc; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: var(--slate); font-size: 0.875rem; margin-bottom: 16px; }
        
        /* Metric cards */
        .metric-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; }
        .metric-card { padding: 12px; border: 1px solid #e2e8f0; border-radius: 12px; }
        .metric-card .label { font-size: 0.7rem; color: var(--slate); }
        .metric-card .value { font-size: 1.5rem; font-weight: 700; margin: 4px 0; }
        .metric-card .sub { font-size: 0.7rem; color: var(--slate); }
        .metric-card .bar { height: 6px; background: #e2e8f0; border-radius: 3px; margin-top: 8px; overflow: hidden; }
        .metric-card .bar-fill { height: 100%; border-radius: 3px; transition: width 0.3s; }
        .metric-card .bar-fill.burgundy { background: var(--burgundy); }
        .metric-card .bar-fill.teal { background: var(--teal); }
        .metric-card .bar-fill.green { background: #10b981; }
        
        /* Method sections */
        .method-section { margin-bottom: 24px; }
        .method-section h3 { font-size: 0.9rem; font-weight: 600; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .method-section p { font-size: 0.85rem; color: var(--slate-dark); line-height: 1.5; margin-bottom: 8px; }
        .method-section ul { font-size: 0.85rem; color: var(--slate-dark); line-height: 1.6; padding-left: 20px; }
        
        /* Neural grid */
        .neural-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .neural-item { text-align: center; padding: 12px 8px; background: #f8fafc; border-radius: 12px; }
        .neural-item .emoji { font-size: 1.5rem; }
        .neural-item .count { font-size: 1.25rem; font-weight: 700; margin: 4px 0; }
        .neural-item .label { font-size: 0.65rem; color: var(--slate); }
        
        /* Scan list */
        .scan-list { max-height: 200px; overflow-y: auto; }
        .scan-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 8px;
            margin-bottom: 6px; font-size: 0.8rem;
        }
        .scan-item button { background: none; border: none; cursor: pointer; color: var(--slate); }
        .scan-item button:hover { color: #ef4444; }
        
        /* Footer */
        .footer { text-align: center; padding: 32px 16px; font-size: 0.75rem; color: var(--slate); }
    </style>
</head>
<body>
    <div id="app"></div>
    
    <script>
// ============ CONSTANTS ============
const STORAGE_KEY = 'miami-ready-v3';
const START = new Date('2026-01-11T00:00:00');
const END = new Date('2026-03-21T23:59:59');

const WEEKLY = [
    { dow: 6, type: 'tempo', label: 'Tempo', focus: 'Any Tempo Studio class', icon: 'üßò' },
    { dow: 0, type: 'tempo-scan', label: 'Tempo + Scan', focus: 'Tempo class + Zozofit body scan', icon: 'üìä' },
    { dow: 1, type: 'lower-a', label: 'Lower A', focus: 'Shelf + Side ‚Äî Upper glute max + medius', icon: 'üçë' },
    { dow: 2, type: 'tempo', label: 'Tempo', focus: 'Upper body or cardio', icon: 'üí™' },
    { dow: 3, type: 'lower-b', label: 'Lower B', focus: 'Underbutt ‚Äî Lower glute max + ham tie-in', icon: 'üî•' },
    { dow: 4, type: 'tempo', label: 'Tempo', focus: 'Upper body or recovery', icon: 'üßò' },
    { dow: 5, type: 'lower-c', label: 'Lower C', focus: 'Side Dips ‚Äî Medius + minimus', icon: '‚ú®' },
];

const TEMPLATES = {
    'lower-a': {
        tag: 'Shelf + Side', target: 'Upper glute max + medius',
        why: 'Pulls pelvis back into position. Creates the shelf.',
        exercises: [
            { name: 'Barbell Hip Thrust', sets: '4√ó6-10', note: 'Heavy' },
            { name: 'Barbell RDL', sets: '3√ó8-10' },
            { name: 'Back Extensions (glute bias)', sets: '3√ó12-15', note: 'Pad LOW' },
            { name: 'Banded Lateral Step-Ups', sets: '3√ó10/side' },
            { name: 'Heavy Banded Abduction', sets: '3√ó15-20' },
        ],
    },
    'lower-b': {
        tag: 'Underbutt', target: 'Lower glute max + ham tie-in',
        why: 'Creates depth and hang. Fills the fold.',
        exercises: [
            { name: 'B-Stance Hip Thrust', sets: '4√ó8-10/side', note: 'Heavy' },
            { name: 'B-Stance RDL', sets: '3√ó10/side' },
            { name: 'Elevated Step-Ups', sets: '3√ó10/side', note: 'Lean forward' },
            { name: 'Hyperextensions (glute bias)', sets: '3√ó12-15', note: 'Pad LOW' },
            { name: 'Yoga Ball Hamstring Curls', sets: '3√ó12-15' },
        ],
    },
    'lower-c': {
        tag: 'Side Dips', target: 'Medius + minimus',
        why: 'Stabilizes SI joint. Fills hip dips.',
        exercises: [
            { name: 'Single-Leg Hip Thrust', sets: '3√ó10/side' },
            { name: 'Cossack Squats', sets: '3√ó8/side' },
            { name: 'Curtsy Lunges', sets: '3√ó10/side' },
            { name: 'Side-Lying Leg Raises', sets: '3√ó15/side', note: 'Ankle weights' },
            { name: 'Banded Glute Bridge Pulses', sets: '3√ó20' },
        ],
    },
};

const RESET = ['Right hip flexor stretch ‚Äî 60s', 'Right single-leg glute bridge hold ‚Äî 45s', 'Right side-lying leg raises ‚Äî 20 slow', 'Dead bug ‚Äî 60s'];
const PRIMER = ['Frog pumps ‚Äî 60s (fast pulses)', 'Banded standing abductions ‚Äî 60s'];

const CONNECTION = [
    { v: 'red', emoji: 'üòê', label: 'Not yet', hint: 'Quads doing the work. Go lighter.' },
    { v: 'yellow', emoji: 'ü§î', label: 'Getting there', hint: 'Some glutes. Hold or reduce.' },
    { v: 'green', emoji: 'üòä', label: 'Feeling it', hint: 'Add weight if follicular/ovulatory.' },
    { v: 'sparkles', emoji: 'üî•', label: 'Locked in', hint: 'Progress confidently.' },
];

const CYCLES = [
    { v: 'menstrual', icon: 'üå∏', label: 'Menstrual', note: 'Go lighter if needed.' },
    { v: 'follicular', icon: 'üå±', label: 'Follicular', note: 'Energy rising. Push intensity.' },
    { v: 'ovulatory', icon: '‚òÄÔ∏è', label: 'Ovulatory', note: 'Peak power. Hit PRs.' },
    { v: 'luteal', icon: 'üçÇ', label: 'Luteal', note: 'Maintain, don\'t push.' },
];

const PHASES = [
    { name: 'CONNECT', weeks: '1-3', desc: 'Light load, perfect form.', expect: 'üòê‚Üíü§î' },
    { name: 'BUILD', weeks: '4-7', desc: 'Heavy when üòä. Fast-twitch responds to load.', expect: 'ü§î‚Üíüòä' },
    { name: 'PEAK', weeks: '8-10', desc: 'Intensity peak. Push limits.', expect: 'üòä‚Üíüî•' },
];

const DEFAULT = {
    settings: { proteinGoal: 130, waterGoal: 100, cycle: 'follicular' },
    baseline: { roundness: 32, lift: 83, protrusion: 25 },
    days: {},
    scans: [],
};

// ============ HELPERS ============
const clamp = (n, min, max) => Math.max(min, Math.min(max, n));
const isoDate = d => { const x = new Date(d); x.setHours(0,0,0,0); return x.toISOString().slice(0,10); };
const addDays = (d, n) => { const x = new Date(d); x.setDate(x.getDate() + n); return x; };
const dayDiff = (a, b) => Math.round((new Date(b).setHours(0,0,0,0) - new Date(a).setHours(0,0,0,0)) / 86400000);
const fmtShort = d => new Intl.DateTimeFormat(undefined, { month: 'short', day: 'numeric' }).format(new Date(d));
const fmtLong = d => new Intl.DateTimeFormat(undefined, { weekday: 'short', month: 'long', day: 'numeric' }).format(new Date(d));
const getType = d => WEEKLY.find(w => w.dow === new Date(d).getDay()) || WEEKLY[0];
const getPhase = dayNum => dayNum <= 21 ? PHASES[0] : dayNum <= 49 ? PHASES[1] : PHASES[2];
const connMeta = v => CONNECTION.find(c => c.v === v) || CONNECTION[0];
const cycleMeta = v => CYCLES.find(c => c.v === v) || CYCLES[1];

// ============ STATE ============
let state = { ...DEFAULT };
let view = 'today';
let selectedIso = isoDate(new Date());
let modalOpen = false;

function load() {
    try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) state = { ...DEFAULT, ...JSON.parse(raw) };
    } catch {}
}

function save() {
    try { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); } catch {}
}

function updateDay(iso, patch) {
    state.days[iso] = { ...state.days[iso], ...patch };
    save();
    render();
}

// ============ COMPUTED ============
function getAllDays() {
    const days = [];
    for (let i = 0; i < 70; i++) {
        const d = addDays(START, i);
        days.push({ date: d, iso: isoDate(d), dayNum: i + 1 });
    }
    return days;
}

function getCompletion(iso) {
    const d = state.days[iso] || {};
    const type = getType(iso);
    const isLower = type.type.startsWith('lower-');
    const items = {
        workout: !!d.done,
        protein: (d.protein || 0) >= state.settings.proteinGoal,
        water: (d.water || 0) >= state.settings.waterGoal,
        flex: !!(d.flexL || d.flexR || d.flexM),
    };
    if (isLower) {
        items.reset = !!d.reset;
        items.primer = !!d.primer;
    }
    const total = Object.keys(items).length;
    const done = Object.values(items).filter(Boolean).length;
    return { pct: Math.round((done / total) * 100), items, isLower };
}

function getConnCounts() {
    const counts = { red: 0, yellow: 0, green: 0, sparkles: 0 };
    Object.entries(state.days).forEach(([iso, d]) => {
        if (d.conn && getType(iso).type.startsWith('lower-')) counts[d.conn]++;
    });
    return counts;
}

function getLastValues() {
    const sorted = Object.entries(state.days).sort((a, b) => b[0].localeCompare(a[0]));
    return {
        protein: sorted.find(([k, v]) => v.protein)?.[1]?.protein || '',
        water: sorted.find(([k, v]) => v.water)?.[1]?.water || '',
        flexL: sorted.find(([k, v]) => v.flexL)?.[1]?.flexL || '',
        flexR: sorted.find(([k, v]) => v.flexR)?.[1]?.flexR || '',
        flexM: sorted.find(([k, v]) => v.flexM)?.[1]?.flexM || '',
        htWt: sorted.find(([k, v]) => v.htWt)?.[1]?.htWt || '',
        htReps: sorted.find(([k, v]) => v.htReps)?.[1]?.htReps || '',
    };
}

// ============ RENDER ============
function render() {
    const today = isoDate(new Date());
    const currentDayNum = clamp(dayDiff(START, today) + 1, 1, 70);
    const todayType = getType(today);
    const todayData = state.days[today] || {};
    const todayComp = getCompletion(today);
    const cycle = cycleMeta(state.settings.cycle);
    const phase = getPhase(currentDayNum);
    const completedDays = Object.values(state.days).filter(d => d.done).length;
    const connCounts = getConnCounts();
    const progPct = Math.round((currentDayNum / 70) * 100);
    const circumference = 2 * Math.PI * 22;
    
    const app = document.getElementById('app');
    app.innerHTML = `
        <!-- Header -->
        <div class="header">
            <div class="header-inner">
                <div class="header-brand"><span>üçë</span><small>MIAMI READY</small></div>
                <h1>70-Day Glute Transformation</h1>
                <p>Jan 11 ‚Üí Mar 21, 2026 ‚Ä¢ Day ${currentDayNum}/70</p>
                <div class="header-badges">
                    <span class="badge">${cycle.icon} ${cycle.label}</span>
                    <span class="badge">‚ú® ${phase.name}</span>
                    <span class="badge">‚úì ${completedDays} logged</span>
                </div>
            </div>
        </div>
        
        <!-- Quick Stats -->
        <div class="quick-stats">
            <div class="card">
                <div class="progress-row">
                    <div class="progress-text">
                        <div class="pct" style="color: ${todayComp.pct === 100 ? '#059669' : todayComp.pct >= 50 ? '#d97706' : '#64748b'}">${todayComp.pct}%</div>
                        <div class="label">Today's Progress</div>
                    </div>
                    <div class="progress-ring">
                        <svg width="56" height="56" viewBox="0 0 56 56">
                            <circle class="bg" cx="28" cy="28" r="22" />
                            <circle class="fg" cx="28" cy="28" r="22" stroke-dasharray="${(progPct / 100) * circumference} ${circumference}" />
                        </svg>
                        <div class="text"><span>${progPct}%</span><span style="font-size:0.6rem;color:#64748b">Program</span></div>
                    </div>
                </div>
                <div class="stats-grid">
                    ${todayComp.isLower ? `
                        <div class="stat-item ${todayComp.items.reset ? 'done' : ''}"><div class="icon">${todayComp.items.reset ? '‚úì' : '‚ö°'}</div><div class="label">Reset</div></div>
                        <div class="stat-item ${todayComp.items.primer ? 'done' : ''}"><div class="icon">${todayComp.items.primer ? '‚úì' : 'üî•'}</div><div class="label">Primer</div></div>
                    ` : ''}
                    <div class="stat-item ${todayComp.items.workout ? 'done' : ''}"><div class="icon">${todayComp.items.workout ? '‚úì' : todayType.icon}</div><div class="label">Workout</div></div>
                    <div class="stat-item ${todayComp.items.protein ? 'done' : ''}"><div class="icon">${todayComp.items.protein ? '‚úì' : 'ü•©'}</div><div class="label">Protein</div></div>
                    <div class="stat-item ${todayComp.items.water ? 'done' : ''}"><div class="icon">${todayComp.items.water ? '‚úì' : 'üíß'}</div><div class="label">Water</div></div>
                    <div class="stat-item ${todayComp.items.flex ? 'done' : ''}"><div class="icon">${todayComp.items.flex ? '‚úì' : 'üßò'}</div><div class="label">Stretch</div></div>
                </div>
            </div>
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab ${view === 'today' ? 'active' : ''}" onclick="setView('today')">Today</button>
            <button class="tab ${view === 'calendar' ? 'active' : ''}" onclick="setView('calendar')">Calendar</button>
            <button class="tab ${view === 'progress' ? 'active' : ''}" onclick="setView('progress')">Progress</button>
            <button class="tab ${view === 'method' ? 'active' : ''}" onclick="setView('method')">Method</button>
            <button class="tab ${view === 'settings' ? 'active' : ''}" onclick="setView('settings')">Settings</button>
        </div>
        
        <!-- Content -->
        <div class="content">
            ${renderView()}
        </div>
        
        <!-- Modal -->
        ${renderModal()}
        
        <div class="footer">üçë Miami Ready ‚Ä¢ March 21, 2026 ‚Ä¢ Data saves to localStorage</div>
    `;
}

function renderView() {
    if (view === 'today') return renderToday();
    if (view === 'calendar') return renderCalendar();
    if (view === 'progress') return renderProgress();
    if (view === 'method') return renderMethod();
    if (view === 'settings') return renderSettings();
    return '';
}

function renderToday() {
    const today = isoDate(new Date());
    const type = getType(today);
    const data = state.days[today] || {};
    const isLower = type.type.startsWith('lower-');
    const template = TEMPLATES[type.type];
    const connCounts = getConnCounts();
    
    return `
        <div class="card">
            <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:12px">
                <div>
                    <div style="font-size:1.1rem;font-weight:700">${fmtLong(today)}</div>
                    <div style="font-size:0.8rem;color:var(--slate)">Day ${clamp(dayDiff(START, today) + 1, 1, 70)} ‚Ä¢ ${type.label}</div>
                </div>
                <span class="badge ${data.done ? 'badge-good' : 'badge-warn'}">${data.done ? '‚úì Done' : 'Not logged'}</span>
            </div>
            <p style="font-size:0.85rem;color:var(--slate);margin-bottom:16px">${type.focus}</p>
            
            ${isLower ? `
                <div class="info-card amber">
                    <div class="title">‚ö° Right-Side Reset (3 min)</div>
                    <div class="text">${RESET.map(s => '‚Ä¢ ' + s).join('<br>')}</div>
                </div>
                <div class="info-card teal">
                    <div class="title">üî• Glute Primer (2 min)</div>
                    <div class="text">${PRIMER.map(s => '‚Ä¢ ' + s).join('<br>')}</div>
                </div>
                <div class="info-card burgundy">
                    <div class="title" style="color:var(--burgundy)">üß† Every Rep Cue</div>
                    <div class="text">Exhale ‚Üí posterior tilt ‚Üí squeeze ‚Üí <strong>hold 2 sec</strong></div>
                </div>
                
                <div style="margin-top:12px">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                        <span style="font-weight:600;font-size:0.875rem">Today's Work</span>
                        <span class="badge badge-burgundy">${template.tag}</span>
                    </div>
                    <div class="exercise-list">
                        ${template.exercises.map(ex => `
                            <div class="exercise-item">
                                <span class="name">${ex.name}</span>
                                <span class="sets">${ex.sets}${ex.note ? ' ‚Ä¢ ' + ex.note : ''}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            ` : ''}
            
            <button class="btn btn-primary" style="margin-top:16px" onclick="openModal('${today}')">${data.done ? 'Edit Log' : 'Log Today'} ‚Üí</button>
        </div>
        
        <div class="card">
            <div class="card-title">üß† Neural Connection</div>
            <div class="neural-grid">
                ${CONNECTION.map(c => `
                    <div class="neural-item">
                        <div class="emoji">${c.emoji}</div>
                        <div class="count">${connCounts[c.v]}</div>
                        <div class="label">${c.label}</div>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
}

function renderCalendar() {
    const allDays = getAllDays();
    const selType = getType(selectedIso);
    const selData = state.days[selectedIso] || {};
    const selComp = getCompletion(selectedIso);
    const selDayNum = clamp(dayDiff(START, selectedIso) + 1, 1, 70);
    const selPhase = getPhase(selDayNum);
    const isLower = selType.type.startsWith('lower-');
    const template = TEMPLATES[selType.type];
    
    return `
        <div style="display:grid;gap:16px;grid-template-columns:1fr;${window.innerWidth >= 768 ? 'grid-template-columns:280px 1fr' : ''}">
            <div class="card" style="margin-bottom:0">
                <div class="card-title">üìÖ 70-Day Timeline</div>
                <div class="timeline">
                    ${allDays.map(({ iso, dayNum }) => {
                        const type = getType(iso);
                        const log = state.days[iso];
                        const comp = getCompletion(iso);
                        const conn = log?.conn ? connMeta(log.conn) : null;
                        return `
                            <div class="timeline-item ${iso === selectedIso ? 'selected' : ''}" onclick="selectDay('${iso}')">
                                <div>
                                    <span class="main">${fmtShort(iso)}</span>
                                    <span class="sub">${type.label}</span>
                                </div>
                                <div class="right">
                                    ${conn ? `<span>${conn.emoji}</span>` : ''}
                                    ${log?.done ? '<span class="check">‚úì</span>' : ''}
                                    ${!log?.done && comp.pct > 0 ? `<span style="font-size:0.7rem;opacity:0.6">${comp.pct}%</span>` : ''}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>
            
            <div class="card" style="margin-bottom:0">
                <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:12px">
                    <div>
                        <div style="font-size:1.1rem;font-weight:700">${fmtLong(selectedIso)}</div>
                        <div style="font-size:0.8rem;color:var(--slate)">Day ${selDayNum} ‚Ä¢ ${selType.label}</div>
                    </div>
                    <span class="badge ${selData.done ? 'badge-good' : 'badge-warn'}">${selData.done ? '‚úì Done' : selComp.pct + '%'}</span>
                </div>
                <p style="font-size:0.85rem;color:var(--slate);margin-bottom:12px">${selType.focus}</p>
                
                <div style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:16px">
                    <span class="badge badge-neutral">${selPhase.name}</span>
                    ${selData.conn ? `<span class="badge ${['green','sparkles'].includes(selData.conn) ? 'badge-good' : 'badge-warn'}">${connMeta(selData.conn).emoji} ${connMeta(selData.conn).label}</span>` : ''}
                </div>
                
                ${isLower && template ? `
                    <div style="display:grid;gap:12px;grid-template-columns:1fr 1fr;margin-bottom:16px">
                        <div style="padding:12px;background:#f8fafc;border-radius:12px">
                            <div style="font-weight:600;font-size:0.8rem;margin-bottom:8px">Pre-workout</div>
                            <div style="font-size:0.7rem;color:var(--slate)">${[...RESET, ...PRIMER].map(s => '‚Ä¢ ' + s.split('‚Äî')[0]).join('<br>')}</div>
                        </div>
                        <div style="padding:12px;border:1px solid #e2e8f0;border-radius:12px">
                            <div style="font-weight:600;font-size:0.8rem;margin-bottom:8px">${template.tag}</div>
                            <div style="font-size:0.7rem;color:var(--slate)">${template.exercises.map(e => '‚Ä¢ ' + e.name).join('<br>')}</div>
                        </div>
                    </div>
                ` : ''}
                
                <button class="btn btn-primary" onclick="openModal('${selectedIso}')">Log / Edit ‚Üí</button>
            </div>
        </div>
    `;
}

function renderProgress() {
    const lastScan = state.scans.length ? state.scans[state.scans.length - 1] : null;
    const currentR = lastScan?.roundness ?? state.baseline.roundness;
    const currentP = lastScan?.protrusion ?? state.baseline.protrusion;
    const proteinDays = Object.values(state.days).filter(d => d.protein);
    const waterDays = Object.values(state.days).filter(d => d.water);
    const avgProtein = proteinDays.length ? Math.round(proteinDays.reduce((a, d) => a + d.protein, 0) / proteinDays.length) : 0;
    const avgWater = waterDays.length ? Math.round(waterDays.reduce((a, d) => a + d.water, 0) / waterDays.length) : 0;
    
    return `
        <div class="card">
            <div class="card-title">üìà Booty Metrics</div>
            <div class="chart-container">Chart visualization coming soon</div>
            <div class="metric-grid">
                <div class="metric-card">
                    <div class="label">Roundness</div>
                    <div class="value">${currentR}%</div>
                    <div class="sub">Baseline: ${state.baseline.roundness}% ‚Ä¢ Goal: 45-55%</div>
                    <div class="bar"><div class="bar-fill burgundy" style="width:${currentR}%"></div></div>
                </div>
                <div class="metric-card">
                    <div class="label">Protrusion</div>
                    <div class="value">${currentP}%</div>
                    <div class="sub">Baseline: ${state.baseline.protrusion}% ‚Ä¢ Goal: 35-45%</div>
                    <div class="bar"><div class="bar-fill teal" style="width:${currentP}%"></div></div>
                </div>
                <div class="metric-card">
                    <div class="label">Lift</div>
                    <div class="value">${state.baseline.lift}%</div>
                    <div class="sub" style="color:#059669">ELITE ‚Äî Maintain</div>
                    <div class="bar"><div class="bar-fill green" style="width:${state.baseline.lift}%"></div></div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-title">‚ûï Add Zozofit Scan</div>
            <div class="form-row-3" style="margin-bottom:12px">
                <input type="date" class="form-input" id="scanDate" value="${isoDate(new Date())}">
                <input type="number" class="form-input" id="scanR" placeholder="Roundness %">
                <input type="number" class="form-input" id="scanP" placeholder="Protrusion %">
            </div>
            <button class="btn btn-secondary" onclick="addScan()">Add Scan</button>
            
            ${state.scans.length ? `
                <div class="section-title">Scan History</div>
                <div class="scan-list">
                    ${state.scans.slice().reverse().map(s => `
                        <div class="scan-item">
                            <div><strong>${s.date}</strong> ‚Äî R: ${s.roundness}% ‚Ä¢ P: ${s.protrusion}%</div>
                            <button onclick="deleteScan('${s.date}')">üóë</button>
                        </div>
                    `).join('')}
                </div>
            ` : ''}
        </div>
        
        <div class="card">
            <div class="card-title">ü•© Nutrition Averages</div>
            <div class="form-row">
                <div class="metric-card">
                    <div class="label">Avg Protein</div>
                    <div class="value">${avgProtein}g</div>
                    <div class="sub">/ ${state.settings.proteinGoal}g goal</div>
                </div>
                <div class="metric-card">
                    <div class="label">Avg Water</div>
                    <div class="value">${avgWater}oz</div>
                    <div class="sub">/ ${state.settings.waterGoal}oz goal</div>
                </div>
            </div>
        </div>
    `;
}

function renderMethod() {
    return `
        <div class="method-section">
            <h3>üéØ The Diagnosis</h3>
            <p style="font-size:1.1rem;font-weight:700;color:var(--burgundy)">Your butt is UP but not OUT or AROUND.</p>
            <ul>
                <li><strong>Lift 83% = ELITE.</strong> Don't chase more lift‚Äîmaintain it.</li>
                <li><strong>Roundness 32% = needs work.</strong> Upper/outer glute underdeveloped.</li>
                <li><strong>Protrusion 25% = needs work.</strong> Flat from side, no backward projection.</li>
            </ul>
            <p><strong>The fix:</strong> Fill out SIDEWAYS and BACKWARD. Don't cut.</p>
        </div>
        
        <div class="method-section">
            <h3>ü¶¥ Posture Fix</h3>
            <p>Your posture score (87/100) is misleading. Straight ‚â† supported. When glutes don't push backward, your lumbar spine does.</p>
            <div class="info-card burgundy">
                <div class="title" style="color:var(--burgundy)">Every Rep Cue</div>
                <div class="text">Exhale ‚Üí posterior tilt ‚Üí squeeze ‚Üí <strong>hold 2 sec</strong><br><small>This teaches: "Glutes hold me, not my spine."</small></div>
            </div>
        </div>
        
        <div class="method-section">
            <h3>üçë 3D Glute Split</h3>
            ${Object.entries(TEMPLATES).map(([key, t]) => `
                <div class="card" style="padding:12px;margin-bottom:8px">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px">
                        <strong>${key.replace('lower-', 'Lower ').toUpperCase()}: ${t.tag}</strong>
                        <span class="badge badge-neutral">${t.target}</span>
                    </div>
                    <p style="font-size:0.8rem;color:var(--slate);margin-bottom:8px"><strong>Why:</strong> ${t.why}</p>
                    <div style="font-size:0.75rem;color:var(--slate)">${t.exercises.map(e => e.name).join(' ‚Ä¢ ')}</div>
                </div>
            `).join('')}
        </div>
        
        <div class="method-section">
            <h3>‚ú® 10-Week Phases</h3>
            ${PHASES.map(p => `
                <div class="card" style="padding:12px;margin-bottom:8px">
                    <div style="display:flex;justify-content:space-between;align-items:center">
                        <strong>${p.name}</strong>
                        <span class="badge badge-neutral">Weeks ${p.weeks}</span>
                    </div>
                    <p style="font-size:0.8rem;color:var(--slate);margin-top:4px">${p.desc} Expect: ${p.expect}</p>
                </div>
            `).join('')}
        </div>
        
        <div class="method-section">
            <h3>üß† Connection Key</h3>
            ${CONNECTION.map(c => `
                <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px">
                    <span style="font-size:1.5rem">${c.emoji}</span>
                    <div>
                        <div style="font-weight:600;font-size:0.875rem">${c.label}</div>
                        <div style="font-size:0.75rem;color:var(--slate)">${c.hint}</div>
                    </div>
                </div>
            `).join('')}
        </div>
        
        <div class="method-section">
            <h3>üå∏ Cycle Syncing</h3>
            ${CYCLES.map(c => `
                <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px">
                    <span style="font-size:1.5rem">${c.icon}</span>
                    <div>
                        <div style="font-weight:600;font-size:0.875rem">${c.label}</div>
                        <div style="font-size:0.75rem;color:var(--slate)">${c.note}</div>
                    </div>
                </div>
            `).join('')}
        </div>
        
        <div class="method-section">
            <h3>üë§ Your Profile</h3>
            <ul>
                <li><strong>Body Type:</strong> Androgenic (ACTN3 sprinter gene = fast-twitch)</li>
                <li><strong>Training:</strong> Heavy load > volume. 6-10 reps for main lifts.</li>
                <li><strong>Imbalance:</strong> Right-side weakness from rotated pelvis</li>
                <li><strong>Underdeveloped:</strong> Glute medius (causes hip dips)</li>
                <li><strong>Baseline WHR:</strong> 0.76 (excellent foundation)</li>
            </ul>
        </div>
    `;
}

function renderSettings() {
    const cycle = cycleMeta(state.settings.cycle);
    return `
        <div class="card">
            <div class="card-title">‚öôÔ∏è Settings</div>
            <div class="form-group">
                <label class="form-label">Cycle Phase</label>
                <select class="form-input" onchange="updateSetting('cycle', this.value)">
                    ${CYCLES.map(c => `<option value="${c.v}" ${state.settings.cycle === c.v ? 'selected' : ''}>${c.icon} ${c.label}</option>`).join('')}
                </select>
                <div style="font-size:0.75rem;color:var(--slate);margin-top:4px">${cycle.note}</div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Protein Goal (g)</label>
                    <input type="number" class="form-input" value="${state.settings.proteinGoal}" onchange="updateSetting('proteinGoal', parseInt(this.value))">
                </div>
                <div class="form-group">
                    <label class="form-label">Water Goal (oz)</label>
                    <input type="number" class="form-input" value="${state.settings.waterGoal}" onchange="updateSetting('waterGoal', parseInt(this.value))">
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-title">üíæ Data</div>
            <div style="display:flex;gap:8px;flex-wrap:wrap">
                <button class="btn btn-secondary" style="flex:1" onclick="exportData()">Export Backup</button>
                <label class="btn btn-secondary" style="flex:1;cursor:pointer">
                    Import Backup
                    <input type="file" accept=".json" style="display:none" onchange="importData(event)">
                </label>
            </div>
        </div>
        
        <div class="card">
            <div class="card-title" style="color:#ef4444">üóëÔ∏è Reset</div>
            <p style="font-size:0.85rem;color:var(--slate);margin-bottom:12px">This will delete all your data. Export a backup first!</p>
            <button class="btn btn-secondary" style="border:1px solid #fecaca;color:#ef4444" onclick="resetData()">Reset All Data</button>
        </div>
    `;
}

function renderModal() {
    if (!modalOpen) return '<div class="modal-overlay"></div>';
    
    const type = getType(selectedIso);
    const data = state.days[selectedIso] || {};
    const isLower = type.type.startsWith('lower-');
    const cycle = cycleMeta(state.settings.cycle);
    const dayNum = clamp(dayDiff(START, selectedIso) + 1, 1, 70);
    const last = getLastValues();
    
    return `
        <div class="modal-overlay active" onclick="closeModal()">
            <div class="modal" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <div>
                        <h2>${fmtLong(selectedIso)}</h2>
                        <p>Day ${dayNum} ‚Ä¢ ${type.label}</p>
                    </div>
                    <button class="modal-close" onclick="closeModal()">‚úï</button>
                </div>
                
                <div class="modal-body">
                    <!-- Cycle -->
                    <div class="info-card" style="background:#f8fafc;border:1px solid #e2e8f0;margin-bottom:16px">
                        <div style="font-size:0.75rem;color:var(--slate)">${cycle.icon} ${cycle.label} Phase</div>
                        <div style="font-size:0.85rem">${cycle.note}</div>
                    </div>
                    
                    ${isLower ? `
                        <!-- Pre-workout -->
                        <div class="section-title">Pre-Workout (5 min)</div>
                        <div class="checkbox-item ${data.reset ? 'checked' : ''}" onclick="toggleField('${selectedIso}', 'reset')">
                            <div class="checkbox-box">${data.reset ? '‚úì' : ''}</div>
                            <div class="checkbox-label">‚ö° Right-Side Reset (3 min)</div>
                        </div>
                        <div class="checkbox-item ${data.primer ? 'checked' : ''}" onclick="toggleField('${selectedIso}', 'primer')">
                            <div class="checkbox-box">${data.primer ? '‚úì' : ''}</div>
                            <div class="checkbox-label">üî• Glute Primer (2 min)</div>
                        </div>
                        
                        <!-- Top Sets -->
                        <div class="section-title">Top Sets (6-10 reps)</div>
                        <div class="form-row">
                            <div class="form-group" style="margin-bottom:0">
                                <label class="form-label">Hip Thrust (lbs)</label>
                                <input type="number" class="form-input" id="htWt" value="${data.htWt || ''}" placeholder="${last.htWt || 'weight'}">
                            </div>
                            <div class="form-group" style="margin-bottom:0">
                                <label class="form-label">Reps</label>
                                <input type="number" class="form-input" id="htReps" value="${data.htReps || ''}" placeholder="${last.htReps || '6-10'}">
                            </div>
                        </div>
                        
                        <!-- Connection -->
                        <div class="section-title">Connection</div>
                        <div class="conn-grid">
                            ${CONNECTION.map(c => `
                                <button class="conn-btn ${data.conn === c.v ? 'selected' : ''}" onclick="setConn('${selectedIso}', '${c.v}')">
                                    <span class="emoji">${c.emoji}</span>
                                    <span class="label">${c.label}</span>
                                </button>
                            `).join('')}
                        </div>
                        ${data.conn ? `<p style="font-size:0.75rem;color:var(--slate);margin-top:8px">${connMeta(data.conn).hint}</p>` : ''}
                    ` : `
                        <!-- Tempo -->
                        <div class="section-title">Tempo Class</div>
                        <div class="tempo-grid">
                            ${['Challenge', 'Lower', 'Full Body', 'Upper', 'Cardio', 'Stretch'].map(t => `
                                <button class="tempo-btn ${data.tempo === t ? 'selected' : ''}" onclick="setTempo('${selectedIso}', '${t}')">${t}</button>
                            `).join('')}
                        </div>
                        <div class="form-group" style="margin-top:12px">
                            <label class="form-label">Duration (min)</label>
                            <input type="number" class="form-input" id="tempoDur" value="${data.tempoDur || ''}" placeholder="30">
                        </div>
                    `}
                    
                    <!-- Nutrition -->
                    <div class="section-title">Nutrition</div>
                    <div class="form-group">
                        <label class="form-label">Protein (g)</label>
                        <div style="display:flex;gap:6px;margin-bottom:8px">
                            <button class="quick-btn" onclick="addProtein(30)">+30</button>
                            <button class="quick-btn" onclick="addProtein(20)">+20</button>
                            <button class="quick-btn" onclick="addProtein(10)">+10</button>
                            <button class="quick-btn" onclick="document.getElementById('protein').value=0">Reset</button>
                        </div>
                        <input type="number" class="form-input" id="protein" value="${data.protein || ''}" placeholder="${state.settings.proteinGoal}g goal">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Water (oz)</label>
                        <div style="display:flex;gap:6px;margin-bottom:8px">
                            <button class="quick-btn" onclick="addWater(20)">+20</button>
                            <button class="quick-btn" onclick="addWater(10)">+10</button>
                            <button class="quick-btn" onclick="addWater(5)">+5</button>
                            <button class="quick-btn" onclick="document.getElementById('water').value=0">Reset</button>
                        </div>
                        <input type="number" class="form-input" id="water" value="${data.water || ''}" placeholder="${state.settings.waterGoal}oz goal">
                    </div>
                    
                    <!-- Flexibility -->
                    <div class="section-title">Splits (inches from floor)</div>
                    <div style="display:flex;gap:6px;margin-bottom:12px;flex-wrap:wrap">
                        ${[0, 2, 4, 6, 8, 10].map(v => `<button class="quick-btn" onclick="setAllFlex(${v})">${v}"</button>`).join('')}
                    </div>
                    <div class="form-row-3">
                        <div class="form-group" style="margin-bottom:0">
                            <label class="form-label">Front L</label>
                            <input type="number" class="form-input" id="flexL" value="${data.flexL || ''}" placeholder="${last.flexL || '‚Äî'}" step="0.5">
                        </div>
                        <div class="form-group" style="margin-bottom:0">
                            <label class="form-label">Front R</label>
                            <input type="number" class="form-input" id="flexR" value="${data.flexR || ''}" placeholder="${last.flexR || '‚Äî'}" step="0.5">
                        </div>
                        <div class="form-group" style="margin-bottom:0">
                            <label class="form-label">Middle</label>
                            <input type="number" class="form-input" id="flexM" value="${data.flexM || ''}" placeholder="${last.flexM || '‚Äî'}" step="0.5">
                        </div>
                    </div>
                    
                    <!-- Notes -->
                    <div class="section-title">Notes</div>
                    <textarea class="form-input" id="notes" rows="2" placeholder="Form cues, wins, observations...">${data.notes || ''}</textarea>
                </div>
                
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="saveModal()">${data.done ? 'Update' : 'Complete'} ‚úì</button>
                </div>
            </div>
        </div>
    `;
}

// ============ ACTIONS ============
window.setView = v => { view = v; render(); };
window.selectDay = iso => { selectedIso = iso; render(); };
window.openModal = iso => { selectedIso = iso; modalOpen = true; render(); };
window.closeModal = () => { modalOpen = false; render(); };

window.toggleField = (iso, field) => {
    const d = state.days[iso] || {};
    updateDay(iso, { [field]: !d[field] });
};

window.setConn = (iso, v) => updateDay(iso, { conn: v });
window.setTempo = (iso, v) => updateDay(iso, { tempo: v });

window.addProtein = v => {
    const el = document.getElementById('protein');
    el.value = (parseInt(el.value) || 0) + v;
};

window.addWater = v => {
    const el = document.getElementById('water');
    el.value = (parseInt(el.value) || 0) + v;
};

window.setAllFlex = v => {
    document.getElementById('flexL').value = v;
    document.getElementById('flexR').value = v;
    document.getElementById('flexM').value = v;
};

window.saveModal = () => {
    const type = getType(selectedIso);
    const isLower = type.type.startsWith('lower-');
    const patch = {
        done: true,
        protein: parseInt(document.getElementById('protein').value) || 0,
        water: parseInt(document.getElementById('water').value) || 0,
        flexL: parseFloat(document.getElementById('flexL').value) || null,
        flexR: parseFloat(document.getElementById('flexR').value) || null,
        flexM: parseFloat(document.getElementById('flexM').value) || null,
        notes: document.getElementById('notes').value || '',
    };
    if (isLower) {
        patch.htWt = parseFloat(document.getElementById('htWt').value) || null;
        patch.htReps = parseInt(document.getElementById('htReps').value) || null;
    } else {
        patch.tempoDur = parseInt(document.getElementById('tempoDur').value) || null;
    }
    updateDay(selectedIso, patch);
    closeModal();
};

window.updateSetting = (key, val) => {
    state.settings[key] = val;
    save();
    render();
};

window.addScan = () => {
    const date = document.getElementById('scanDate').value;
    const roundness = parseFloat(document.getElementById('scanR').value);
    const protrusion = parseFloat(document.getElementById('scanP').value);
    if (!date || isNaN(roundness) || isNaN(protrusion)) return alert('Please fill all fields');
    state.scans = [...state.scans.filter(s => s.date !== date), { date, roundness, protrusion }].sort((a, b) => a.date.localeCompare(b.date));
    save();
    document.getElementById('scanR').value = '';
    document.getElementById('scanP').value = '';
    render();
};

window.deleteScan = date => {
    state.scans = state.scans.filter(s => s.date !== date);
    save();
    render();
};

window.exportData = () => {
    const blob = new Blob([JSON.stringify(state, null, 2)], { type: 'application/json' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `miami-ready-backup-${isoDate(new Date())}.json`;
    a.click();
};

window.importData = e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = ev => {
        try {
            state = { ...DEFAULT, ...JSON.parse(ev.target.result) };
            save();
            render();
            alert('Data imported!');
        } catch { alert('Invalid file'); }
    };
    reader.readAsText(file);
};

window.resetData = () => {
    if (confirm('Are you sure? This cannot be undone.')) {
        localStorage.removeItem(STORAGE_KEY);
        state = { ...DEFAULT };
        render();
    }
};

// ============ INIT ============
load();
render();
window.addEventListener('resize', () => { if (view === 'calendar') render(); });
    </script>
</body>
</html>
